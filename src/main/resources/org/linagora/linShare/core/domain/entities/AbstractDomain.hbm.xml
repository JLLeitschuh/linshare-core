<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping default-access="field" package="org.linagora.linShare.core.domain.entities">

	<typedef
		class="org.linagora.linShare.core.repository.hibernate.type.GenericEnumType" name="roleEnumType">
		<param name="enumClass">org.linagora.linShare.core.domain.entities.Role</param>
		<param name="identifierMethod">toInt</param>
		<param name="valueOfMethod">fromInt</param>
	</typedef>
	

	<class name="AbstractDomain" table="DOMAIN_ABSTRACT" discriminator-value= "-1" >
		<id name="persistenceId" type="long">
			<column name="ID" not-null="true" index="index_abstract_domain_id"/>
			<generator class="native" />
		</id>
		 
		<discriminator column="TYPE" type="integer" />
		
		<property access="field" column="IDENTIFIER" name="identifier" not-null="true" unique="true" index="index_abstract_domain_identifier" />
		<property access="field" column="LABEL" name="label" not-null="true" />
		<property access="field" column="ENABLE" name="enable" not-null="true" />
		<property access="field" column="TEMPLATE" name="template" not-null="true" />
		<property access="field" column="DESCRIPTION" name="description" />
		<property access="field" column="DEFAULT_ROLE" name="defaultRole" type="roleEnumType" />
		<property access="field" column="DEFAULT_LOCALE" name="defaultLocale" />
		<property access="field" column="USED_SPACE" name="usedSpace" not-null="true"/>
		<property access="field" column="auth_show_order" name="authShowOrder" />
		
		<many-to-one name="userProvider" class="org.linagora.linShare.core.domain.entities.LdapUserProvider" 
			column="USER_PROVIDER_ID" unique="true" lazy="false" cascade="delete" />
			
		<many-to-one name="policy" class="org.linagora.linShare.core.domain.entities.DomainPolicy" 
			column="DOMAIN_POLICY_ID" not-null="true" lazy="false" />
    	
		<many-to-one name="parentDomain" column="PARENT_ID" class="AbstractDomain" lazy="false"/>
		<set name="subdomain" lazy="false" cascade="all-delete-orphan">
	 		<key column="PARENT_ID" />
	 		<one-to-many class="AbstractDomain" />
	 	</set>
	
		<set name="functionalities" inverse="true" cascade="all-delete-orphan" lazy="false">
			<key column="DOMAIN_ID" />
			<one-to-many class="Functionality"  />
		</set>
		
		<set name="domainAccessRules" inverse="true" cascade="delete-orphan">
			<key column="DOMAIN_ID" />
			<one-to-many class="DomainAccessRule"  />
		</set>
	
		<many-to-one cascade="save-update" lazy="false" access="field" class="org.linagora.linShare.core.domain.entities.MessagesConfiguration" 
			name="messagesConfiguration" column="MESSAGES_CONFIGURATION_ID" not-null="false" />

<!-- 
 		<many-to-one cascade="save-update" lazy="false" access="field" class="org.linagora.linShare.core.domain.entities.MessagesConfiguration" 
			name="messagesConfiguration" column="MESSAGES_CONFIGURATION_ID" not-null="true" />
 -->
			
		<list name="shareExpiryRules" table="SHARE_EXPIRY_RULES" lazy="false">
      		<key>
	     		<column name="DOMAIN_ID" not-null="true" index="index_share_expiry_rule_id"/>
    		</key>
      		<list-index column="RULE_SORT_ORDER"/>
	      	<composite-element class="ShareExpiryRule">
		        <property column="EXPIRY_TIME" name="shareExpiryTime"/>
		        <property column="TIME_UNIT_ID" name="shareExpiryUnit" type="timeUnitEnumType"/>
		        <property column="SHARE_SIZE" name="shareSize"/>
		        <property column="SIZE_UNIT_ID" name="shareSizeUnit" type="fileSizeEnumType"/>
	      	</composite-element>
	    </list>
	 	
		<subclass discriminator-value="0" name="org.linagora.linShare.core.domain.entities.RootDomain"></subclass>
		<subclass discriminator-value="1" name="org.linagora.linShare.core.domain.entities.TopDomain"></subclass>
		<subclass discriminator-value="2" name="org.linagora.linShare.core.domain.entities.SubDomain"></subclass>
		<subclass discriminator-value="3" name="org.linagora.linShare.core.domain.entities.GuestDomain"></subclass>

	</class>
</hibernate-mapping>


