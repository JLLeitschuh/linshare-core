<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<t:MyBorderLayout t:title="message:pages.thread.index.title" t:identifier="thread" t:currentHighlight="thread"
        xmlns:t="http://tapestry.apache.org/schema/tapestry_5_0_0.xsd"
        xmlns:p="tapestry:parameter">
        
    <div id="content">
        <h1>${message:pages.thread.index.title} : ${currentThread.name}</h1>
        <t:messagePanel />
        <t:businessMessagesDisplayer />
        <!-- Page content -->

        <div id="actionBar">
            <h4>Actions</h4>
            <ul>
                <li>
                <br></br><br></br>
	                <t:actionLink class="button" t:id="editThread" t:zone="threadEditFormZone"
                            title="${message:pages.thread.admin.renameButton}">
                        <span onclick="threadEditWindow.showCenter(true)">
                            <img src="${asset:context:images/icons/edit-button.png}" alt=""/>
                            ${message:pages.thread.admin.renameButton}
                        </span>
                    </t:actionLink>
                </li>
            </ul>
        </div>

		<h2>${message:pages.thread.admin.index}</h2>

        <div id="pageContent">
        		<table>
					<tr>
					<form t:type="form" t:id="formSearch" >
						<td>
							<t:textfield t:id="searchMembers"  t:validate="required" t:value="recipientsSearchMember" t:size="50" t:mixins="autocomplete" 
				    		t:minChars="${autocompleteMin}" class="recipientsPattern"
				    		title="${message:components.quickSharePopup.texarea.recipients.title}"/>
				    	</td>
				    	<td>
        					<input type="submit" id="submit" value="${message:global.button.search}"/>
        				</td>
        				</form>
        				<td>
        				 	<form t:type="form" t:id="resetSearch">
        						<input type="submit" id="stop" value="${message:global.button.reset}"/>
        					</form>
       					</td>
        			</tr>
        			 <tr>
        				<td>
        				<p>
        				<t:form id="formRadio">	
							<t:radiogroup t:id="searchCriteria" t:value="criteriaOnSearch">
				                    <t:radio t:id="all" onclick="this.form.submit()" />&nbsp;<t:label for="all">${message:pages.thread.admin.button.all}</t:label>&nbsp;
				                    ${message:global.space}
				                    <t:radio t:id="admin" onclick="this.form.submit()" />&nbsp;<t:label for="admin">${message:pages.thread.admin.button.admin}</t:label>&nbsp;
				                    ${message:global.space}			                    
				                    <t:radio t:id="simple" onclick="this.form.submit()" />&nbsp;<t:label for="simple">${message:pages.thread.admin.button.simple}</t:label>&nbsp;
				                    ${message:global.space}
				               		<t:radio t:id="restricted" onclick="this.form.submit()" />&nbsp;<t:label for="restricted">${message:pages.thread.admin.button.restricted}</t:label>&nbsp;
				                    ${message:global.space}
			               	</t:radiogroup>
			            </t:form>
			            </p>
			        	</td>
			        </tr>
        		</table>
			<p>${message:pages.thread.notification}</p>
			<br></br><br></br>
			<div class="clear"></div>
            <t:grid source="members" row="member" rowsPerPage="10" include="fullName,mail" add="type,edit,delete" >
                        					<p:empty>
        						${message:pages.thread.adminThread.search}
        					</p:empty> 
                <p:typeCell>
                    <t:delegate to="type" />

		            <t:block id="adminBlock">
                        <span><img src="${asset:context:images/icons/usertype-small-admin2.png}" alt="${message:pages.thread.userType.admin}" title="${message:pages.thread.userType.admin}"/></span>
		            </t:block>

                    <t:block id="userBlock">
                        <span><img src="${asset:context:images/icons/usertype-small-normal.png}" alt="${message:pages.thread.userType.user}" title="${message:pages.thread.userType.user}"/></span>
		            </t:block>

                    <t:block id="restrictedUserBlock">
                        <span><img src="${asset:context:images/icons/usertype-small-restricted.png}" alt="${message:pages.thread.userType.userRestricted}" title="${message:pages.thread.userType.userRestricted}"/></span>
		            </t:block>
                </p:typeCell>

                <p:deleteCellHeader>
                    ${message:pages.thread.member.delete}
                </p:deleteCellHeader>

                <p:editCell>
                    <t:actionLink t:id="editMember" t:context="${member.lsUuid}" t:zone="memberEditFormZone">
                        <span onclick="memberEditWindow.showCenter(true)">
                            <img src="${asset:context:images/icons/edit-button.png}" alt="${message:global.button.edit}"
                                title="${message:pages.thread.editUserType}" />
                        </span>
                    </t:actionLink>
                </p:editCell>
                <p:deleteCell>
                	<t:if t:test="isDeletable">
                    <t:actionLink t:id="deleteMember" t:context="${member.lsUuid}" t:zone="zoneConfirmDelete">
                        <span onclick="window_confirm_0.showCenter(true);">
                            <img src="${asset:context:images/popupImages/less.png}" alt="${message:global.button.delete}"
                                title="${message:pages.thread.member.delete}" />
                        </span>
                    </t:actionLink>
                </t:if>
                </p:deleteCell>
            </t:grid>
        </div><!-- id="list" -->
			<br></br>
      		<div class="clear"></div>
				<fieldset style="width: 1000;" class="title_criteria_zone" id="userCriterion">
				<legend align="top" class="palette">${message:pages.thread.addUser}</legend>		
					<table>
						<tr>
						<form t:type="form" t:id="form">
							<td>
							<t:textfield t:id="searchUser" t:validate="required" t:value="recipientsSearch" t:size="50" t:mixins="autocomplete" 
				    		t:minChars="${autocompleteMin}" class="recipientsPattern"
				    		title="${message:components.quickSharePopup.texarea.recipients.title}"/>
				    		</td>
				    		<td>
        					<input type="submit" value="${message:global.button.search}"/>
        					</td>
        					</form>
        					<td>
        				<form t:type="form" t:id="resetSearchByUser">
        					<input type="submit" style="margin-right:340px" id="reset" value="${message:global.button.reset}"/>
       					</form>
        					</td>
        				</tr>
        			</table>
        			<br></br>
        			<t:if t:test="displayGrid">
        				<t:grid source="userSearchResults"  rowsPerPage="5" include="firstName,lastName,mail" add="inList,addRemove"   row="result" width="500">
	    				    <p:empty>
        						${message:pages.thread.adminThread.search}
        					</p:empty> 
	    				   
	    				   <t:parameter name="inListCell">
			  					<t:if t:test="isInList">
			  						<img src="${asset:context:images/icons/validate-mini.png}"/>
			  					<p:else>
			  						<img src="${asset:context:images/icons/absent-small.png}"/>
			  					</p:else>
								</t:if>
			 				</t:parameter>
			 				<t:parameter name="addRemoveCell">
			 					<t:if t:test="isInList">
			 						<t:if t:test="isDeletable">
			 						<t:actionLink t:id="deleteUser" context="[result.domainIdentifier,result.mail]"
			 	 						title="${message:pages.thread.member.delete}">
										<img src="${asset:context:images/popupImages/less.png}" alt="${message:global.button.delete}" />
									</t:actionLink>
									</t:if>
			  					<p:else>
			  						<t:actionLink t:id="addUser" context="[result.domainIdentifier,result.mail]"
			 	 						title="${message:pages.thread.addUser}">
										<img src="${asset:context:images/popupImages/plus.png}" alt="${message:pages.thread.adduser}" />
									</t:actionLink>
			  					</p:else>
								</t:if>
			 				</t:parameter>
	    				</t:grid>
        			</t:if>
				</fieldset>

	    <div class="clear"></div>

        <t:actionLink t:id="back" class="button" title="${message:pages.thread.admin.back}">
            <span><img src="${asset:context:images/icons/cancel.png}" alt="" /> ${message:pages.thread.admin.back}</span>
        </t:actionLink>
        <br/>

	    <!-- Popups -->

        <div style="display:none">
            <t:zone t:id="memberEditTemplateZone">
                <t:threadMemberEditForm members="members" editMemberId="selectedMemberId" currentThread="currentThread" />
            </t:zone>
        </div>

        <div t:id="memberEditWindow">
            <t:zone id="memberEditFormZone" update="show" />
        </div>

        <div style="display:none">
            <t:zone t:id="threadEditTemplateZone">
                <t:threadEditForm currentThread="currentThread" />
            </t:zone>
        </div>

        <div t:id="threadEditWindow">
            <t:zone id="threadEditFormZone" update="show" />
        </div>

	    <!-- Delete thread confirm popup -->
        <t:confirmPopup t:eventName="deleteThreadPopupEvent"
            t:messageLabel="${message:pages.thread.admin.confirmDelete}"/>

	    <!-- Delete member confirm popup -->
        <t:zone t:id="zoneConfirmDelete" />
        <t:confirmPopup t:eventName="deleteMemberPopupEvent"
            t:messageLabel="${message:pages.thread.admin.member.confirmDelete}"/>

		<!-- <t:threadEditForm t:editThreadWithUuid="${currentThread.lsUuid}" /> -->
    </div>
</t:MyBorderLayout>