<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<t:MyBorderLayout t:title="message:pages.administration.lists.index" t:identifier="lists" t:currentHighlight="lists"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_0_0.xsd" xmlns:p="tapestry:parameter">
	
	<!-- Main content -->
			
		<div id="content">
		
		<h1>${message:pages.lists.index}: ${mailingList.identifier} - ${mailingList.owner.firstName} ${mailingList.owner.lastName} </h1>
		<br></br>
		<h2> ${message:pages.administration.displayLists.index}</h2>

		<t:if test="UserIsOwner">
				<t:if test="isEmpty">
						${message:pages.lists.empty}
			<p:else>
			<t:grid source="contacts" rowsPerPage="10" include="firstName,lastName,mail" add="actions" row="contact">
			<t:parameter name="actionsCell">
			 	 		<t:actionLink t:id="editContact" context="contact.mail"
			 	 			href="#formBis"
			 	 			title="${message:pages.lists.index.list.contact.edit.button}">
							<img src="${asset:context:images/icons/edit-button.png}" alt="${message:pages.lists.index.list.contact.edit.button}" />
						</t:actionLink>
			 	 		<t:actionLink t:id="deleteContact" context="contact.mail" t:zone="zoneConfirmDelete"
			 	 			title="${message:pages.lists.index.list.display.delete.button}">
			 	 			<span onclick="window_confirm.showCenter(true)">
							<img src="${asset:context:images/popupImages/less.png}" alt="${message:global.button.delete}" />
							</span>
						</t:actionLink>
			</t:parameter>
			 </t:grid>
			</p:else>
		</t:if>
		<div class="clear"></div>
		
		<t:if test="inModify">
		
			<form t:type="form" t:id="editContactForm">
				<fieldset class="title_criteria_zone" id="contactCriterion">
				<legend align="top" class="palette">${message:pages.lists.index.list.contact.edit.button}</legend>
				<p><t:label for="email"/>:&nbsp;
        		<t:textfield t:id="emailBis" value="email"/></p><br></br>
				
				<p><t:label for="firstName"/>:&nbsp;
        		<t:textfield t:id="firstNameBis" value="firstName" /></p><br></br>
   		
   				<p><t:label for="lastName"/>:&nbsp;
        		<t:textfield t:id="lastNameBis" value="lastName" /></p><br></br>
		
        		<p><input type="submit"  value="${message:pages.lists.index.list.contact.edit.button}"/>
        		<input t:type="submit" t:id="reset" value="${message:global.button.reset}"/></p>
				</fieldset>
			</form>
		<p:else>
			<form t:type="form" t:id="addContactForm">
				<fieldset class="title_criteria_zone" id="contactCriterion">
				<legend align="top" class="palette">${message:pages.lists.addContact}</legend>
				<p><t:label for="email"/>:&nbsp;
        		<t:textfield t:id="email" value="email"/></p><br></br>
				
				<p><t:label for="firstName"/>:&nbsp;
        		<t:textfield t:id="firstName" value="firstName"/></p><br></br>
   		
   				<p><t:label for="lastName"/>:&nbsp;
        		<t:textfield t:id="lastName" value="lastName" /></p><br></br>
		
        		<p><input type="submit"  value="${message:pages.lists.addContact}"/></p>
				</fieldset>
			</form>
		</p:else>
		</t:if>
			
	  <div class="clear"></div>

			<form t:type="form" t:id="SearchUserForm">
				<fieldset style="width: 1000;" class="title_criteria_zone" id="userCriterion">
				<legend align="top" class="palette">${message:pages.lists.addUser}</legend>		
					<table>
						<tr>
							<td>
							<t:textfield t:id="searchUser" t:validate="required" t:value="recipientsSearch" t:size="50" t:mixins="autocomplete" 
				    		t:minChars="${autocompleteMin}" class="recipientsPattern"
				    		title="${message:components.quickSharePopup.texarea.recipients.title}"/>
				    		</td>
				    		<td>
        					<input type="submit" style="margin-right:380px" value="${message:global.button.search}"/>
        					</td>
        				</tr>
        			</table>
        			
        			
        			<t:if t:test="displayGrid">
        				<t:grid source="results"  rowsPerPage="5" include="firstName,lastName,mail" add="inList , addRemove"   row="result" width="500">
	    					<t:parameter name="inListCell">
			  					<t:if t:test="isInList">
			  						<img src="${asset:context:images/icons/validate-mini.png}"/>
			  					<p:else>
			  						<img src="${asset:context:images/icons/absent-small.png}"/>
			  					</p:else>
								</t:if>
			 				</t:parameter>
			 				<t:parameter name="addRemoveCell">
			 					<t:if t:test="isInList">
			 						<t:actionLink t:id="deleteUser" context="[result.firstName,result.lastName,result.mail]"
			 	 						title="${message:pages.lists.index.list.display.delete.button}">
										<img src="${asset:context:images/popupImages/less.png}" alt="${message:global.button.delete}" />
									</t:actionLink>
			  					<p:else>
			  						<t:actionLink t:id="addUser" context="[result.firstName,result.lastName,result.mail]"
			 	 						title="${message:pages.lists.adduser}">
										<img src="${asset:context:images/popupImages/plus.png}" alt="${message:pages.lists.adduser}" />
									</t:actionLink>
			  					</p:else>
								</t:if>
			 				</t:parameter>
	    				</t:grid>
        			</t:if>
				</fieldset>
			</form>
		<p:else>
		<t:grid source="contacts" rowsPerPage="15" include="firstName,lastName,mail"></t:grid>
		</p:else>
		</t:if>
	  <div class="clear"></div>
		<t:actionLink t:id="back" class="button">
		<span>${message:pages.thread.admin.back}</span>
		</t:actionLink>
		<br></br>
		</div><!-- id="content" -->
		
		
		<t:confirmPopup
        t:messageLabel="${message:pages.lists.delete.display.ask}"
        t:eventName="contactDeleteEvent" t:windowId="confirm1" />
        
        
	    <t:zone t:id="zoneConfirmDelete" />
		
	</t:MyBorderLayout>